# 레이아웃/언어별 입력 이슈(한글/영문/IME 등)

USB HID 키보드 입력은 “키코드 + modifier” 기반이라, **언어/레이아웃/IME 상태**에 따라 결과 문자가 달라질 수 있습니다.

## Q. 왜 같은 키 입력인데 문자 결과가 달라지나요?
A. 키보드는 ‘문자’를 보내는 게 아니라 ‘키’를 보냅니다. 문자는 OS의 키보드 레이아웃과 IME가 결정합니다.

- 예: `Shift + 2`가 `@`인지 `"`인지(레이아웃에 따라 다름)
- 예: 한글 입력 중 조합 상태에서 다음 키가 들어오면 예상과 다르게 합성될 수 있음

## 한/영 전환(IME 토글) 안정화 팁
- 시작 전 타깃 입력기를 가능한 한 **영문 상태**로 맞추고 시작합니다.
- 토글 키(예: Right Alt/CapsLock 등)는 환경마다 다릅니다.
- 토글 직후에는 반드시 **대기(Mode Switch Delay)**가 필요할 수 있습니다.

권장 전략:
1) 토글 키를 실제 환경과 맞추기
2) `modeSwitchDelayMs`를 충분히 크게 두기
3) 한글이 많이 포함된 작업은 중간 분할(Stop/Start) 고려

## 자주 발생하는 증상과 처방

### 증상: 한글이 깨진다/중간이 섞인다
- 원인 후보: IME 조합 상태, 토글 타이밍 부족, 포커스 변경
- 처방:
  - `modeSwitchDelayMs` 증가
  - `typingDelayMs` 증가(조합 안정화)
  - 테스트는 메모장 → 성공 후 IDE로

### 증상: 특수문자가 다른 문자로 찍힌다
- 원인 후보: 키보드 레이아웃(US/KO) 불일치
- 처방:
  - Target PC의 키보드 레이아웃을 확인(Windows: 설정 → 시간 및 언어 → 언어 및 지역)
  - 가능한 한 “테스트/운영 환경에서 동일 레이아웃”으로 고정

### 증상: 탭/개행이 예상과 다르게 처리된다
- 원인 후보: IDE/터미널의 자동 들여쓰기/자동 완성/단축키 충돌
- 처방:
  - 단순 에디터에서 먼저 테스트
  - IDE의 자동기능을 끄거나, 옵션(라인 시작 공백/탭 무시)을 사용

## 권장 입력 테스트 세트
아래 텍스트로 환경을 빠르게 검증할 수 있습니다.

1) ASCII
- `ABC abc 123` 
- `[]{}()<>` 
- `!@#$%^&*_-+=` 

2) 개행/탭
- `line1\n\tindent\nline3` 형태

3) 한글
- `한글 테스트: 가나다라마바사` 
- `영문/한글 혼합: abc한글def` 

이 테스트에서 실패하면, 본문 입력 전에 IME/딜레이/레이아웃부터 해결하는 게 좋습니다.
